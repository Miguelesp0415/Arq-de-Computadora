#include <Adafruit_NeoPixel.h> 

Adafruit_NeoPixel LED_RGB(1, 48, NEO_GRBW + NEO_KHZ800); 

// Pines de Hardware
int LED_PIN = 2;
int BTN_SOS = 4;   
int BTN_BLINK = 5; 
int BTN_PULSO = 6; 


void setup() {
  // Configuración inicial del NeoPixel
  LED_RGB.begin();
  LED_RGB.setBrightness(150);
  colorearRGB(0,0,0);
  
  // Configuración de pines de entrada y salida
  pinMode(LED_PIN, OUTPUT);
  pinMode(BTN_SOS, INPUT_PULLUP);
  pinMode(BTN_BLINK, INPUT_PULLUP);
  pinMode(BTN_PULSO, INPUT_PULLUP);
}

void loop() {
  // Pin 4 (BTN_SOS) - Activa el efecto PULSO (Fade)
  if (digitalRead(BTN_SOS) == LOW) {
    pulso(); 
  }

  // Pin 5 (BTN_BLINK) - Activa el efecto BLINK (Parpadeo corto)
  else if (digitalRead(BTN_BLINK) == LOW) {
    blink();
  }

  // Pin 6 (BTN_PULSO) - Activa el efecto SOS
  else if (digitalRead(BTN_PULSO) == LOW) {
    sos(); 
  }
}


// Función para establecer el color del NeoPixel
void colorearRGB(int red, int green, int blue) {
  LED_RGB.setPixelColor(0, (uint32_t(LED_RGB.Color(red, green, blue))));
  LED_RGB.show();
}

// Funciones auxiliares para SOS y BLINK
void corto() {
  analogWrite(LED_PIN, 255);
  colorearRGB(random(0, 256), random(0, 256), random(0, 256));
  delay(200);

  analogWrite(LED_PIN, 0);
  colorearRGB(0, 0, 0);
  delay(100);
}

void largo() {
  analogWrite(LED_PIN, 255);
  colorearRGB(random(0, 256), random(0, 256), random(0, 256));
  delay(400);

  analogWrite(LED_PIN, 0);
  colorearRGB(0, 0, 0);
  delay(100);
}

// Lógica de la secuencia SOS (S-S-S O-O-O S-S-S)
void sos() {
  corto(); corto(); corto();
  largo(); largo(); largo();
  corto(); corto(); corto();
}

// Lógica de la secuencia BLINK (7 parpadeos cortos)
void blink() {
  for(int i = 1; i <= 7; i++) {
    corto();
  }
}


// Lógica del efecto PULSO (Fade In/Out)
void pulso() {
  // Fade-In (Brillo de 0 a 255) - Color AZUL
  for (int brillo = 0; brillo <= 255; brillo++) {
    analogWrite(LED_PIN, brillo);   
    colorearRGB(0, 0, 255);        
    LED_RGB.setBrightness(brillo); 
    delay(5);
  }

  // Fade-Out (Brillo de 255 a 0) - Color VERDE
  for (int brillo = 255; brillo >= 0; brillo--) {
    analogWrite(LED_PIN, brillo);   
    colorearRGB(0, 255, 0);      
    LED_RGB.setBrightness(brillo); 
    delay(10);
  }

  // Apagado final
  colorearRGB(0,0,0); 
  LED_RGB.setBrightness(150);
  digitalWrite(LED_PIN, LOW);
}
